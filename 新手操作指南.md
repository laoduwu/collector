# 飞书文章收集系统 - 新手操作指南

> 专为非程序员准备的详细教程，每一步都有说明

## 📋 目录

- [第一部分：理解这个系统](#第一部分理解这个系统)
- [第二部分：准备工作（注册账号）](#第二部分准备工作注册账号)
- [第三部分：本地测试（可选）](#第三部分本地测试可选)
- [第四部分：云端部署](#第四部分云端部署)
- [第五部分：开始使用](#第五部分开始使用)

---

## 第一部分：理解这个系统

### 这个系统是做什么的？

**简单来说**：你向飞书机器人发送一个文章链接，它会自动帮你：
1. 抓取文章内容
2. 下载文章里的图片
3. 根据文章标题，自动分类到合适的文件夹
4. 保存到飞书知识库

**举个例子**：
- 你发送：`https://mp.weixin.qq.com/s/xxxxx`（一篇关于Python的微信文章）
- 机器人自动：抓取文章 → 智能判断 → 保存到"技术/Python"文件夹
- 你就能在飞书知识库里看到这篇文章了

### 工作流程图

```
你 → 发送URL给飞书机器人
         ↓
机器人收到消息 → 触发云端处理
         ↓
云端服务器（GitHub Actions）：
  1. 抓取文章内容
  2. 下载所有图片
  3. 上传图片到云端
  4. 用AI判断应该放哪个文件夹
  5. 保存到飞书知识库
         ↓
20-60秒后 → 你在飞书看到新文章
```

### 需要花钱吗？

**完全免费！** 所有用到的服务都有免费版本，够用。

---

## 第二部分：准备工作（注册账号）

### 步骤1：飞书开放平台（10分钟）

**目的**：创建一个飞书机器人

#### 1.1 打开飞书开放平台

1. 用浏览器打开：https://open.feishu.cn/
2. 点击右上角【登录】
3. 用你的飞书账号登录（就是平时用飞书的账号）

#### 1.2 创建应用

1. 登录后，点击【创建企业自建应用】
2. 填写应用信息：
   - **应用名称**：填 `文章收集助手`（或你喜欢的名字）
   - **应用描述**：填 `自动收集文章到知识库`
   - **应用图标**：随便选一个
3. 点击【创建】

#### 1.3 记录重要信息

创建完成后，你会看到一个页面，上面有：

```
App ID: cli_xxxxxxxxxx
App Secret: xxxxxxxxxxxxxxxx
```

**重要**：把这两个复制到记事本里保存好，待会要用。

#### 1.4 开通权限

1. 在左侧菜单找到【权限管理】
2. 点击【添加权限】
3. 搜索并勾选以下权限：
   - `获取与发送单聊、群组消息` (im:message)
   - `以应用身份读取消息` (im:message.group_at_msg)
   - `创建、编辑文档` (docx:document)
   - `访问知识库` (wiki:wiki)
4. 点击【确定】

#### 1.5 获取安全验证信息（重要）

**说明**：这两个参数用于验证飞书消息的安全性，我们稍后配置时需要用到。

1. 在左侧菜单找到【开发配置】
2. 点击【事件与回调】（或【Events & Callbacks】）
3. 找到【加密策略】（或【Encryption Policy】）标签页
4. 获取两个重要信息：

**获取 Verification Token**：
   - 在"Verification Token"那一栏
   - 如果是空的，点击旁边的【重置】按钮
   - 会生成一个类似 `v_xxxxxxxxxx` 的字符串
   - 复制保存

**获取 Encrypt Key（可选）**：
   - 在"Encrypt Key"那一栏
   - 如果是空的，点击旁边的【重置】按钮
   - 会生成一个加密密钥
   - 复制保存
   - **注意**：如果你后面会用HTTPS（推荐），这个可以不设置

**保存到记事本**：
```
飞书配置
App ID: cli_xxxxxxxxxx
App Secret: xxxxxxxxxxxxxxxx
Verification Token: v_xxxxxxxxxx
Encrypt Key: xxxxxxxxxx（可选）
```

> 💡 **小提示**：
> - 如果找不到"事件与回调"，可能叫"事件订阅"
> - Verification Token 是必需的
> - Encrypt Key 如果使用HTTPS可以留空（我们会用HTTPS）

---

### 步骤2：Jina AI（5分钟）

**目的**：这是用来做智能分类的AI服务

#### 2.1 注册账号

1. 打开：https://jina.ai/
2. 点击【Sign Up】（注册）
3. 用邮箱注册（随便一个邮箱都行，比如Gmail）
4. 验证邮箱（收邮件点链接）

#### 2.2 获取API Key

1. 登录后，点击头像 → 【API Keys】
2. 点击【Create New API Key】
3. 名字随便填，比如 `feishu-collector`
4. 创建后，复制这个API Key（长这样：`jina_xxxxxxxxxx`）

**保存到记事本**：
```
Jina AI
API Key: jina_xxxxxxxxxx
```

---

### 步骤3：GitHub（10分钟）

**目的**：用来存储图片和运行程序

#### 3.1 注册GitHub账号（如果还没有）

1. 打开：https://github.com/
2. 点击【Sign up】注册
3. 填写邮箱、密码、用户名
4. 验证邮箱

#### 3.2 创建图片仓库

1. 登录后，点击右上角【+】→【New repository】
2. 填写：
   - **Repository name**：填 `collector-images`
   - **Description**：填 `文章图片存储`
   - **Public**：选这个（重要！必须是公开的）
3. 点击【Create repository】

#### 3.3 创建代码仓库

1. 再次点击【+】→【New repository】
2. 填写：
   - **Repository name**：填 `collector`
   - **Description**：填 `飞书文章收集系统`
   - **Public**：选这个
3. 点击【Create repository】

#### 3.4 创建Personal Access Token

1. 点击右上角头像 → 【Settings】（设置）
2. 左侧菜单最下面 → 【Developer settings】
3. 点击【Personal access tokens】→【Tokens (classic)】
4. 点击【Generate new token】→【Generate new token (classic)】
5. 填写：
   - **Note**：填 `collector-token`
   - **Expiration**：选 `No expiration`（永不过期）
   - **权限**：勾选 `repo` 和 `workflow`
6. 点击最下面【Generate token】
7. 复制这个token（长这样：`ghp_xxxxxxxxxx`）

**重要**：这个token只显示一次，一定要保存好！

**保存到记事本**：
```
GitHub
用户名: your-username
图片仓库: your-username/collector-images
Token: ghp_xxxxxxxxxx
```

---

### 步骤4：获取飞书知识库ID（5分钟）

#### 4.1 找到你的知识库

1. 打开飞书
2. 进入你想保存文章的知识库

#### 4.2 获取知识库ID

1. 看浏览器地址栏，会有类似这样的网址：
   ```
   https://xxx.feishu.cn/wiki/WxxxxxxxxxxxxxxH
   ```
2. 其中 `WxxxxxxxxxxxxxxH` 就是知识库ID
3. 复制保存下来

#### 4.3 创建"待整理"文件夹

1. 在知识库里，点击【新建】→【文件夹】
2. 名字必须是：`待整理`（中文，这个很重要）
3. 创建完成

**保存到记事本**：
```
飞书知识库
Space ID: WxxxxxxxxxxxxxxH
待整理文件夹: 已创建✓
```

---

## 第三部分：本地测试（可选）

> 如果你不懂编程，可以跳过这部分，直接看第四部分

这部分需要在电脑上安装Python，比较复杂，建议跳过。

---

## 第四部分：云端部署

### 步骤5：上传代码到GitHub（10分钟）

#### 5.1 下载代码

你现在在本地有个 `collector` 文件夹，里面是我帮你写好的所有代码。

#### 5.2 上传到GitHub

**方法A：使用GitHub Desktop（推荐给新手）**

1. 下载GitHub Desktop：https://desktop.github.com/
2. 安装并登录你的GitHub账号
3. 点击【File】→【Add Local Repository】
4. 选择你的 `collector` 文件夹
5. 点击【Publish repository】
6. 确认名字是 `collector`，点击【Publish】

**方法B：使用网页上传（简单但慢）**

1. 打开你的GitHub仓库：https://github.com/你的用户名/collector
2. 点击【uploading an existing file】
3. 把 `collector` 文件夹里的所有文件拖进去
4. 点击【Commit changes】

---

### 步骤6：配置GitHub Secrets（10分钟）

**这一步是把你的密钥安全地告诉GitHub**

#### 6.1 打开Settings

1. 打开你的 `collector` 仓库页面
2. 点击【Settings】（设置）
3. 左侧菜单找到【Secrets and variables】→【Actions】
4. 点击【New repository secret】

#### 6.2 添加所有Secrets

**一个一个添加**，每次：
1. 点击【New repository secret】
2. 填写Name和Value
3. 点击【Add secret】

需要添加的内容（从你的记事本复制）：

| Name（名称） | Value（值） | 说明 |
|-------------|------------|------|
| `FEISHU_APP_ID` | cli_xxxxxxxxxx | 飞书App ID |
| `FEISHU_APP_SECRET` | xxxxxxxxxxxxxxxx | 飞书App Secret |
| `FEISHU_VERIFICATION_TOKEN` | vxxxxxxxxxx | 飞书Verification Token |
| `FEISHU_ENCRYPT_KEY` | exxxxxxxxxx | 飞书Encrypt Key（如果有） |
| `FEISHU_KNOWLEDGE_SPACE_ID` | WxxxxxxxxxxxxxxH | 知识库ID |
| `FEISHU_UNORGANIZED_FOLDER_NAME` | 待整理 | 待整理文件夹名 |
| `JINA_API_KEY` | jina_xxxxxxxxxx | Jina AI密钥 |
| `GH_TOKEN` | ghp_xxxxxxxxxx | GitHub Token |
| `GITHUB_REPO` | 你的用户名/collector-images | 图片仓库 |

**重要**：
- Name必须完全一样，包括大小写
- Value从记事本复制，不要有多余的空格

---

### 步骤7：部署Cloudflare Workers（15分钟）

**这一步是创建接收飞书消息的服务**

#### 7.1 注册Cloudflare

1. 打开：https://cloudflare.com/
2. 点击【Sign Up】注册
3. 填写邮箱和密码（完全免费，不需要信用卡）

#### 7.2 安装Wrangler CLI

**Windows用户**：
1. 下载安装Node.js：https://nodejs.org/
2. 打开"命令提示符"（按Win+R，输入cmd，回车）
3. 输入：`npm install -g wrangler`
4. 等待安装完成

**Mac用户**：
1. 打开"终端"（按Cmd+Space，输入terminal）
2. 输入：`npm install -g wrangler`
3. 等待安装完成

#### 7.3 登录Cloudflare

在命令提示符/终端中：
```bash
wrangler login
```
会打开浏览器，点击【Allow】允许访问

#### 7.4 进入webhook文件夹

**Windows**：
```bash
cd C:\你的路径\collector\webhook-receiver
```

**Mac**：
```bash
cd /Users/ericz/projects/collector/webhook-receiver
```

#### 7.5 配置Secrets

依次执行这些命令（每次输入一个，按回车后粘贴对应的值）：

```bash
wrangler secret put FEISHU_VERIFICATION_TOKEN
# 粘贴你的Verification Token，回车

wrangler secret put GITHUB_TOKEN
# 粘贴你的GitHub Token，回车

wrangler secret put GITHUB_REPO
# 粘贴：你的用户名/collector，回车
```

#### 7.6 部署

```bash
wrangler deploy
```

部署成功后，会显示一个网址，类似：
```
https://feishu-webhook-receiver.你的用户名.workers.dev
```

**重要**：把这个网址复制保存，待会要用！

---

### 步骤8：配置飞书Webhook（5分钟）

**最后一步：让飞书知道往哪里发消息**

#### 8.1 打开飞书开放平台

1. 回到：https://open.feishu.cn/
2. 进入你的应用【文章收集助手】

#### 8.2 配置请求网址

1. 在左侧菜单找到【开发配置】
2. 点击【事件与回调】（或可能叫【事件订阅】）
3. 找到【请求网址配置】（或【Request URL Configuration】）
4. 粘贴你的Cloudflare Workers网址：
   ```
   https://feishu-webhook-receiver.你的用户名.workers.dev
   ```
5. 点击【验证】或【校验】按钮
6. 如果显示"验证成功"或"校验通过"，点击【保存】

> 💡 **验证失败？**
> - 确保Cloudflare Workers已经部署成功
> - 确保第1.5步的Verification Token已配置
> - 稍等1-2分钟后再试

#### 8.3 添加事件订阅

1. 在同一个【事件与回调】页面
2. 往下滚动，找到【添加事件】按钮
3. 搜索或找到：`接收消息 v2.0`
   - 英文名称：`im.message.receive_v1`
   - 说明：接收用户发送的消息
4. 勾选这个事件
5. 点击【确定】或【保存】

#### 8.4 发布应用

1. 左侧菜单找到【版本管理与发布】
2. 点击【创建版本】
3. 填写：
   - **版本号**：v1.0（或自动生成）
   - **版本说明**：填 `初始版本` 或 `文章收集功能`
4. 点击【保存】
5. 点击【申请发布】（或【申请线上发布】）
6. 点击【确定】
7. 等待审核（企业自建应用通常立即通过）

> 💡 **小提示**：
> - 企业自建应用的审核通常是自动通过的
> - 如果是发布到应用商店，才需要人工审核
> - 发布后权限才会生效

---

## 第五部分：开始使用

### 步骤9：添加机器人（2分钟）

#### 9.1 创建单聊

1. 打开飞书
2. 点击【+】→【添加机器人】
3. 搜索你的应用名称【文章收集助手】
4. 点击【添加】

或者在群里添加机器人：
1. 进入群聊
2. 点击右上角【...】→【设置】
3. 【群机器人】→【添加机器人】
4. 选择【文章收集助手】

### 步骤10：测试使用（1分钟）

#### 10.1 发送测试消息

在与机器人的对话框中，发送：
```
https://example.com
```

#### 10.2 等待处理

等待20-60秒（第一次可能慢一点）

#### 10.3 检查结果

1. 打开飞书知识库
2. 应该能看到新增的文章
3. 如果匹配不到合适的文件夹，会出现在【待整理】里

---

## 💡 使用技巧

### 支持的网站

✅ 支持：
- 微信公众号文章
- 知乎文章
- Medium文章
- 个人博客
- 大部分新闻网站

❌ 可能不支持：
- 需要登录才能看的文章
- 视频网站
- 纯图片网站

### 目录匹配

系统会根据文章标题自动分类，例如：
- "Python入门教程" → 可能放到"技术/Python"
- "产品设计方法论" → 可能放到"产品/设计"
- 无法判断的 → 放到"待整理"

你可以在飞书知识库里创建任何文件夹结构，系统会自动学习。

---

## ❓ 常见问题

### Q1: 发送链接后没反应？

**检查清单**：
1. 机器人是否已添加？
2. GitHub Actions是否在运行？
   - 打开 https://github.com/你的用户名/collector/actions
   - 看看是否有新的运行记录
3. Cloudflare Workers是否部署成功？
   - 命令行输入：`wrangler tail`
   - 看看有没有新日志

### Q2: 文章抓取失败？

可能原因：
- 网站有反爬虫限制
- 微信文章需要更长时间
- URL格式错误

### Q3: 图片不显示？

检查：
- GitHub仓库 `collector-images` 是否是Public（公开）
- 等待1-2分钟，CDN需要缓存

### Q4: 所有文章都进"待整理"？

可能原因：
- Jina AI额度用完（每月1号重置）
- 知识库文件夹结构太简单（建议多创建几个）
- 文章标题和文件夹名称差异太大

### Q5: 我想手动调整文章位置？

目前需要在飞书知识库里手动拖动，未来会添加命令功能。

---

## 📞 获取帮助

如果遇到问题：

1. **查看日志**：
   - GitHub: https://github.com/你的用户名/collector/actions
   - 点击最近的运行记录，查看详细日志

2. **检查配置**：
   - 确认所有Secrets都配置正确
   - 确认"待整理"文件夹存在

3. **寻求帮助**：
   - 把错误信息截图
   - 把GitHub Actions的日志复制出来
   - 联系技术支持

---

## 🎉 恭喜完成！

现在你可以：
- 向机器人发送任何文章链接
- 自动保存到飞书知识库
- 享受智能分类的便利

祝使用愉快！📚✨
